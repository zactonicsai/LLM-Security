<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>LLM Security Checklist | MITRE ATLAS + OWASP</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { 'display': ['Space Grotesk'], 'mono': ['JetBrains Mono'], 'body': ['IBM Plex Sans'] },
          colors: {
            cyber: { 950: '#050810', 900: '#0a0e17', 800: '#0f1629', 700: '#151d35', 600: '#1c2642', 500: '#243354', 400: '#2d4066', 300: '#3d5a80', 200: '#5c7a99', 100: '#8fa7bf', 50: '#c5d5e4' },
            accent: { cyan: '#00d4ff', green: '#00ff88', amber: '#ffb800', red: '#ff3d57', purple: '#a855f7' }
          }
        }
      }
    }
  </script>
  <style>
    .dark { scrollbar-width: thin; scrollbar-color: #3d5a80 #0f1629; }
    .dark::-webkit-scrollbar { width: 8px; } .dark::-webkit-scrollbar-track { background: #0f1629; } .dark::-webkit-scrollbar-thumb { background: #3d5a80; border-radius: 4px; }
    html:not(.dark) { scrollbar-width: thin; scrollbar-color: #94a3b8 #f1f5f9; }
    html:not(.dark)::-webkit-scrollbar { width: 8px; } html:not(.dark)::-webkit-scrollbar-track { background: #f1f5f9; } html:not(.dark)::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
    html { scroll-behavior: smooth; }
    body { -webkit-tap-highlight-color: transparent; }
    .dark .grid-bg { background-color: #0a0e17; background-image: linear-gradient(rgba(0,212,255,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(0,212,255,0.03) 1px, transparent 1px); background-size: 50px 50px; }
    html:not(.dark) .grid-bg { background-color: #f8fafc; background-image: linear-gradient(rgba(14,165,233,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(14,165,233,0.05) 1px, transparent 1px); background-size: 50px 50px; }
    .status-critical { border-left: 3px solid #ff3d57; } .status-high { border-left: 3px solid #ffb800; } .status-medium { border-left: 3px solid #a855f7; } .status-low { border-left: 3px solid #00ff88; }
    .checklist-item.completed { opacity: 0.6; }
    .dark .checklist-item.completed .item-title { text-decoration: line-through; color: #5c7a99; }
    html:not(.dark) .checklist-item.completed .item-title { text-decoration: line-through; color: #94a3b8; }
    .dark .toc-item.active { background: linear-gradient(90deg, rgba(0,212,255,0.15), transparent); border-left: 2px solid #00d4ff; }
    html:not(.dark) .toc-item.active { background: linear-gradient(90deg, rgba(14,165,233,0.15), transparent); border-left: 2px solid #0ea5e9; }
    .dark input[type="checkbox"] { appearance: none; width: 22px; height: 22px; border: 2px solid #3d5a80; border-radius: 5px; background: #0f1629; cursor: pointer; position: relative; }
    .dark input[type="checkbox"]:checked { background: linear-gradient(135deg, #00d4ff, #00ff88); border-color: #00d4ff; }
    .dark input[type="checkbox"]:checked::after { content: '‚úì'; position: absolute; color: #0a0e17; font-weight: bold; font-size: 14px; top: 50%; left: 50%; transform: translate(-50%, -50%); }
    html:not(.dark) input[type="checkbox"] { appearance: none; width: 22px; height: 22px; border: 2px solid #cbd5e1; border-radius: 5px; background: #fff; cursor: pointer; position: relative; }
    html:not(.dark) input[type="checkbox"]:checked { background: linear-gradient(135deg, #0ea5e9, #22c55e); border-color: #0ea5e9; }
    html:not(.dark) input[type="checkbox"]:checked::after { content: '‚úì'; position: absolute; color: #fff; font-weight: bold; font-size: 14px; top: 50%; left: 50%; transform: translate(-50%, -50%); }
    .dark textarea { background: #0f1629; border: 1px solid #243354; color: #c5d5e4; }
    html:not(.dark) textarea { background: #fff; border: 1px solid #e2e8f0; color: #1e293b; }
    textarea:focus { outline: none; border-color: #00d4ff; }
    .progress-ring { transform: rotate(-90deg); }
    .sidebar-overlay { opacity: 0; visibility: hidden; transition: all 0.3s; } .sidebar-overlay.active { opacity: 1; visibility: visible; }
    .mobile-sidebar { transform: translateX(-100%); transition: transform 0.3s; } .mobile-sidebar.active { transform: translateX(0); }
    .touch-target { min-height: 44px; min-width: 44px; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    .animate-slide-up { animation: slideUp 0.3s ease-out; }
    .animate-slide-in { animation: slideIn 0.3s ease-out; }
    .framework-badge { font-size: 9px; padding: 2px 6px; border-radius: 4px; font-family: 'JetBrains Mono', monospace; }
    .checklist-item-clickable { cursor: pointer; transition: transform 0.15s, box-shadow 0.15s; }
    .checklist-item-clickable:hover { transform: translateX(3px); }
    .step-num { width: 26px; height: 26px; min-width: 26px; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-size: 12px; font-weight: 600; }
    @media (max-width: 767px) { #detail-modal > div { max-height: 90vh; } }
  </style>
</head>
<body class="font-body min-h-screen grid-bg">
  <div id="sidebar-overlay" class="sidebar-overlay fixed inset-0 bg-black/60 backdrop-blur-sm z-40 md:hidden" onclick="closeSidebar()"></div>

  <!-- Header -->
  <header class="fixed top-0 left-0 right-0 z-50 backdrop-blur-sm border-b dark:bg-cyber-900/95 dark:border-cyber-600 bg-white/95 border-slate-200">
    <div class="max-w-[1800px] mx-auto px-3 md:px-6 py-3 md:py-4">
      <div class="flex items-center justify-between md:hidden">
        <button onclick="toggleSidebar()" class="touch-target p-2 -ml-2 rounded-lg dark:hover:bg-cyber-700 hover:bg-slate-100">
          <svg class="w-6 h-6 dark:text-cyber-100 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>
        <span class="font-display font-bold text-sm dark:text-white text-slate-900">LLM Security</span>
        <div class="flex items-center gap-1">
          <span class="font-mono text-sm font-bold text-accent-cyan" id="mobile-progress">0%</span>
          <button onclick="toggleTheme()" class="p-2 rounded-lg dark:hover:bg-cyber-700 hover:bg-slate-100">
            <svg class="w-5 h-5 dark:text-cyber-100 text-slate-700 dark:block hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
            <svg class="w-5 h-5 dark:text-cyber-100 text-slate-700 dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
          </button>
        </div>
      </div>
      <div class="hidden md:flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-accent-cyan to-accent-green flex items-center justify-center">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
          </div>
          <div>
            <h1 class="font-display font-bold text-xl dark:text-white text-slate-900">LLM Security Checklist</h1>
            <p class="text-xs font-mono dark:text-cyber-200 text-slate-500">MITRE ATLAS + OWASP LLM Top 10 | Click items for details</p>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <div class="flex items-center gap-3 px-4 py-2 rounded-lg border dark:bg-cyber-800 dark:border-cyber-600 bg-slate-50 border-slate-200">
            <svg class="w-12 h-12 progress-ring" viewBox="0 0 36 36">
              <path class="dark:text-cyber-700 text-slate-200" stroke="currentColor" stroke-width="3" fill="none" d="M18 2.0845a15.9155 15.9155 0 010 31.831 15.9155 15.9155 0 010-31.831"/>
              <path id="progress-circle" class="text-accent-cyan" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round" stroke-dasharray="0, 100" d="M18 2.0845a15.9155 15.9155 0 010 31.831 15.9155 15.9155 0 010-31.831"/>
            </svg>
            <div class="text-center">
              <div class="font-mono text-xl font-bold dark:text-white text-slate-900" id="progress-percent">0%</div>
              <div class="text-xs dark:text-cyber-200 text-slate-500">Complete</div>
            </div>
          </div>
          <button onclick="toggleTheme()" class="p-2.5 rounded-lg border dark:bg-cyber-700 dark:border-cyber-500 bg-slate-100 border-slate-200" title="Toggle theme">
            <svg class="w-5 h-5 dark:text-cyber-100 text-slate-700 dark:block hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
            <svg class="w-5 h-5 dark:text-cyber-100 text-slate-700 dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
          </button>
          <button onclick="exportJSON()" class="px-4 py-2 rounded-lg border font-mono text-sm flex items-center gap-2 dark:bg-cyber-700 dark:border-cyber-500 dark:text-cyber-100 bg-slate-100 border-slate-200 text-slate-700">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>JSON
          </button>
          <button onclick="exportMarkdown()" class="px-4 py-2 rounded-lg border font-mono text-sm flex items-center gap-2 dark:bg-accent-purple/20 dark:border-accent-purple/50 dark:text-accent-purple bg-purple-50 border-purple-200 text-purple-700">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>Report (.md)
          </button>
          <label class="px-4 py-2 rounded-lg border font-mono text-sm flex items-center gap-2 cursor-pointer dark:bg-cyber-700 dark:border-cyber-500 dark:text-cyber-100 bg-slate-100 border-slate-200 text-slate-700">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>Import
            <input type="file" accept=".json" onchange="importJSON(event)" class="hidden">
          </label>
          <button onclick="resetAll()" class="px-4 py-2 bg-accent-red/20 border border-accent-red/50 text-accent-red rounded-lg font-mono text-sm">Reset</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Mobile Sidebar -->
  <aside id="mobile-sidebar" class="mobile-sidebar fixed left-0 top-0 bottom-0 w-[85%] max-w-[320px] z-50 md:hidden overflow-hidden flex flex-col dark:bg-cyber-800 bg-white border-r dark:border-cyber-600 border-slate-200">
    <div class="p-4 border-b flex items-center justify-between dark:border-cyber-600 border-slate-200">
      <h2 class="font-display font-semibold dark:text-white text-slate-900">Menu</h2>
      <button onclick="closeSidebar()" class="p-2 rounded-lg dark:hover:bg-cyber-700 hover:bg-slate-100">
        <svg class="w-6 h-6 dark:text-cyber-100 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>
    <nav id="mobile-toc" class="flex-1 overflow-y-auto p-3 space-y-1"></nav>
    <div class="p-4 border-t dark:border-cyber-600 border-slate-200 space-y-2">
      <button onclick="exportMarkdown(); closeSidebar()" class="w-full py-3 rounded-lg border font-mono text-sm flex items-center justify-center gap-2 dark:bg-accent-purple/20 dark:border-accent-purple/50 dark:text-accent-purple bg-purple-50 border-purple-200 text-purple-700">üìÑ Export Report (.md)</button>
      <button onclick="exportJSON(); closeSidebar()" class="w-full py-3 rounded-lg border font-mono text-sm dark:bg-cyber-700 dark:border-cyber-500 dark:text-cyber-100 bg-slate-100 border-slate-200 text-slate-700">üíæ Export JSON</button>
    </div>
  </aside>

  <!-- Desktop Sidebar -->
  <aside class="hidden md:block fixed left-0 top-[73px] bottom-0 w-72 border-r overflow-y-auto dark:bg-cyber-800/50 dark:border-cyber-600 bg-slate-50/80 border-slate-200">
    <div class="p-4">
      <h2 class="font-display font-semibold text-sm uppercase tracking-wider mb-4 dark:text-cyber-200 text-slate-500">Sections</h2>
      <nav id="desktop-toc" class="space-y-1"></nav>
    </div>
    <div class="p-4 border-t dark:border-cyber-600 border-slate-200">
      <h3 class="font-display font-semibold text-sm uppercase tracking-wider mb-3 dark:text-cyber-200 text-slate-500">Stats</h3>
      <div class="space-y-2 text-sm">
        <div class="flex justify-between"><span class="dark:text-cyber-300 text-slate-500">Critical</span><span id="stat-critical" class="font-mono text-accent-red">0/0</span></div>
        <div class="flex justify-between"><span class="dark:text-cyber-300 text-slate-500">High</span><span id="stat-high" class="font-mono text-accent-amber">0/0</span></div>
        <div class="flex justify-between"><span class="dark:text-cyber-300 text-slate-500">Medium</span><span id="stat-medium" class="font-mono text-accent-purple">0/0</span></div>
        <div class="flex justify-between"><span class="dark:text-cyber-300 text-slate-500">Low</span><span id="stat-low" class="font-mono text-accent-green">0/0</span></div>
      </div>
      <p class="mt-4 pt-4 border-t text-xs dark:border-cyber-700 dark:text-cyber-400 border-slate-200 text-slate-400">üí° Click items for implementation steps</p>
    </div>
  </aside>

  <!-- Main -->
  <main class="md:ml-72 pt-16 md:pt-24 pb-24 md:pb-8">
    <div class="max-w-5xl mx-auto px-3 md:px-6" id="main-content"></div>
  </main>

  <!-- Mobile Bottom Bar -->
  <div class="fixed bottom-0 left-0 right-0 backdrop-blur-sm border-t p-3 md:hidden z-30 dark:bg-cyber-800/95 dark:border-cyber-600 bg-white/95 border-slate-200">
    <div class="flex gap-2">
      <button onclick="exportMarkdown()" class="flex-1 py-3 rounded-lg border font-mono text-xs flex flex-col items-center gap-1 dark:bg-accent-purple/20 dark:border-accent-purple/50 dark:text-accent-purple bg-purple-50 border-purple-200 text-purple-700">üìÑ Report</button>
      <button onclick="exportJSON()" class="flex-1 py-3 rounded-lg border font-mono text-xs dark:bg-cyber-700 dark:border-cyber-500 dark:text-cyber-100 bg-slate-100 border-slate-200 text-slate-700">üíæ JSON</button>
      <label class="flex-1 py-3 rounded-lg border font-mono text-xs flex items-center justify-center cursor-pointer dark:bg-cyber-700 dark:border-cyber-500 dark:text-cyber-100 bg-slate-100 border-slate-200 text-slate-700">üì• Import<input type="file" accept=".json" onchange="importJSON(event)" class="hidden"></label>
      <button onclick="resetAll()" class="flex-1 py-3 bg-accent-red/20 border border-accent-red/50 text-accent-red rounded-lg font-mono text-xs">üóëÔ∏è</button>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-20 md:bottom-6 right-3 md:right-6 left-3 md:left-auto z-50 space-y-2"></div>

  <!-- Detail Modal -->
  <div id="detail-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 hidden items-center justify-center p-4" onclick="if(event.target===this)closeDetail()">
    <div class="rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto border shadow-2xl animate-slide-up dark:bg-cyber-800 dark:border-cyber-500 bg-white border-slate-200">
      <div class="sticky top-0 p-4 border-b flex items-center justify-between dark:bg-cyber-800 dark:border-cyber-600 bg-white border-slate-200 z-10">
        <h2 class="font-display font-bold text-lg dark:text-white text-slate-900">Implementation Guide</h2>
        <button onclick="closeDetail()" class="p-2 rounded-lg dark:hover:bg-cyber-700 hover:bg-slate-100">
          <svg class="w-6 h-6 dark:text-cyber-100 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div id="detail-content" class="p-4 md:p-6"></div>
    </div>
  </div>

  <!-- Comment Modal -->
  <div id="comment-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 hidden items-center justify-center p-4" onclick="if(event.target===this)closeComment()">
    <div class="rounded-xl p-4 md:p-6 w-full max-w-lg border shadow-2xl animate-slide-up dark:bg-cyber-800 dark:border-cyber-500 bg-white border-slate-200">
      <h3 class="font-display font-bold text-lg mb-2 dark:text-white text-slate-900">Add Comment</h3>
      <p id="comment-title" class="mb-4 text-sm dark:text-cyber-200 text-slate-500"></p>
      <textarea id="comment-input" class="w-full h-32 rounded-lg p-3 font-mono text-sm resize-none" placeholder="Enter notes..."></textarea>
      <div class="flex justify-end gap-3 mt-4">
        <button onclick="closeComment()" class="px-4 py-2 rounded-lg border font-mono text-sm dark:bg-cyber-700 dark:border-cyber-500 dark:text-cyber-100 bg-slate-100 border-slate-200 text-slate-700">Cancel</button>
        <button onclick="saveComment()" class="px-4 py-2 bg-accent-cyan/20 border border-accent-cyan text-accent-cyan rounded-lg font-mono text-sm">Save</button>
      </div>
    </div>
  </div>

<script>
const THEME_KEY = 'llm-sec-theme';
const STATE_KEY = 'llm-sec-state-v5';

function initTheme() {
  const s = localStorage.getItem(THEME_KEY);
  const d = window.matchMedia('(prefers-color-scheme: dark)').matches;
  document.documentElement.classList.toggle('dark', s === 'dark' || (!s && d));
}
function toggleTheme() {
  const isDark = document.documentElement.classList.toggle('dark');
  localStorage.setItem(THEME_KEY, isDark ? 'dark' : 'light');
  toast(isDark ? 'Dark mode' : 'Light mode', 'info');
}
initTheme();

// DATA
const data = {
  sections: [
    {
      id: "offline-llm", title: "1. Offline/Local LLM Security", short: "Offline LLM",
      icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>`,
      desc: "Critical security for locally-hosted LLM deployments.",
      items: [
        { id: "off-1", title: "Model File Access Controls", desc: "Restrict model file permissions to service account only.", priority: "critical", frameworks: ["ATLAS AML.T0035"],
          steps: ["Identify model storage locations (e.g., ~/.ollama/models)", "Create service account: sudo useradd -r -s /bin/false llm-service", "Change ownership: sudo chown -R llm-service:llm-service /path/to/models", "Set permissions: sudo chmod 700 /path/to/models", "Configure inference service to run as this account"],
          verify: ["ls -la shows only service account access", "Regular users get 'Permission denied'", "Process runs as service account: ps aux | grep inference"] },
        { id: "off-2", title: "Inference Runtime Isolation", desc: "Run inference in isolated container with limited access.", priority: "critical", frameworks: ["ATLAS AML.T0041"],
          steps: ["Create Docker container with minimal base image", "Run with --read-only --cap-drop=ALL flags", "Apply seccomp profile for syscall restrictions", "Mount models as read-only volumes", "Set memory/CPU limits: --memory=16g --cpus=4"],
          verify: ["docker inspect shows SecurityOpt settings", "Write attempts inside container fail", "Resource limits enforced under load"] },
        { id: "off-3", title: "System Prompt Protection", desc: "Encrypt system prompts. Prevent extraction via file access.", priority: "critical", frameworks: ["OWASP LLM07"],
          steps: ["Move prompts to secrets manager (Vault, AWS SM)", "If file-based, encrypt with SOPS/age", "Load prompts at runtime only", "Add extraction detection to input validation"],
          verify: ["grep -r 'system.*prompt' finds no plaintext", "Config files contain no sensitive prompts", "'Repeat your instructions' attacks fail"] },
        { id: "off-4", title: "Conversation Log Security", desc: "Encrypt logs at rest. Implement retention policies.", priority: "critical", frameworks: ["OWASP LLM02"],
          steps: ["Enable disk encryption (LUKS/FileVault)", "Configure log rotation with 30-day retention", "Implement PII redaction before logging", "Restrict log access to security team"],
          verify: ["Disk encryption status verified", "Log rotation configured and working", "PII patterns not visible in logs"] },
        { id: "off-5", title: "GPU Memory Isolation", desc: "Clear GPU memory between sessions to prevent data leakage.", priority: "high", frameworks: ["ATLAS AML.T0024"],
          steps: ["Enable NVIDIA MPS for process isolation", "Implement torch.cuda.empty_cache() after sessions", "Set CUDA_VISIBLE_DEVICES per process", "Monitor GPU memory with nvidia-smi"],
          verify: ["nvidia-smi shows isolation per process", "No data patterns after session end"] },
        { id: "off-6", title: "Local API Authentication", desc: "Even localhost APIs need authentication tokens.", priority: "high", frameworks: ["OWASP LLM06"],
          steps: ["Generate secure API keys (256-bit)", "Implement auth middleware for all endpoints", "Bind server to 127.0.0.1 only", "Add per-key rate limiting"],
          verify: ["API without key returns 401", "netstat shows 127.0.0.1 binding only", "Rate limits trigger correctly"] },
        { id: "off-7", title: "Model Update Verification", desc: "Verify checksums before loading any model.", priority: "critical", frameworks: ["ATLAS AML.T0010", "OWASP LLM03"],
          steps: ["Get SHA-256 checksums from official source", "Verify before every model load", "Block load on checksum mismatch", "Alert security team on failures"],
          verify: ["Modified model file fails to load", "Verification in startup sequence", "Alerts trigger on mismatch"] },
        { id: "off-8", title: "Resource Limits", desc: "Prevent resource exhaustion attacks.", priority: "high", frameworks: ["OWASP LLM10"],
          steps: ["Set cgroup limits: MemoryMax, CPUQuota", "Configure request timeouts (120s max)", "Implement request queue with max depth", "Monitor and alert at 80% threshold"],
          verify: ["Stress test shows limits enforced", "Oversized requests rejected gracefully"] }
      ]
    },
    {
      id: "user-security", title: "2. User/Personal LLM Security", short: "User Security",
      icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>`,
      desc: "Security for personal LLM use: finance management, document analysis, note-taking (Obsidian), K8S management.",
      items: [
        { id: "usr-1", title: "Financial Document Isolation", desc: "Isolate LLM processing of receipts, invoices, and financial docs from other data.", priority: "critical", frameworks: ["OWASP LLM02", "PCI-DSS"],
          steps: ["Create dedicated folder for financial docs with restricted permissions", "Use separate LLM context/session for financial processing", "Never mix financial data with other document types in same prompt", "Implement automatic PII masking before LLM processing", "Store processed results encrypted, separate from source docs"],
          verify: ["Financial docs in isolated directory", "LLM sessions don't persist financial context", "Bank account numbers, amounts masked in logs", "Encryption verified on output storage"] },
        { id: "usr-2", title: "Document Upload Sanitization", desc: "Scan and sanitize all uploaded documents before LLM processing.", priority: "critical", frameworks: ["ATLAS AML.T0051.001"],
          steps: ["Implement file type validation (PDF, images, text only)", "Scan for malware before processing", "Strip metadata from documents (EXIF, PDF metadata)", "Check for hidden text/layers in PDFs", "Limit file sizes to prevent DoS"],
          verify: ["Unknown file types rejected", "AV scan runs on each upload", "exiftool shows no metadata post-processing", "Hidden text detection working"] },
        { id: "usr-3", title: "Obsidian/Note Integration Security", desc: "Secure LLM integration with note-taking apps like Obsidian.", priority: "high", frameworks: ["OWASP LLM02"],
          steps: ["Use local-only LLM plugins (no cloud API calls)", "Restrict plugin file system access to vault only", "Disable auto-sync during LLM processing", "Review plugin permissions before install", "Backup vault before enabling LLM features"],
          verify: ["Network monitor shows no external calls", "Plugin can't access files outside vault", "Sync paused during processing", "Backup exists and is recent"] },
        { id: "usr-4", title: "K8S/Infrastructure LLM Guardrails", desc: "Prevent destructive operations when using LLM for K8S management.", priority: "critical", frameworks: ["MITRE ATLAS", "CIS K8S"],
          steps: ["Run LLM suggestions in --dry-run mode first", "Implement approval workflow for destructive commands (delete, scale to 0)", "Use separate kubeconfig with limited RBAC for LLM", "Log all LLM-suggested commands before execution", "Set resource quotas to prevent cluster exhaustion"],
          verify: ["Destructive commands require confirmation", "LLM kubeconfig has minimal permissions", "All commands logged with source=llm tag", "Resource quotas enforced"] },
        { id: "usr-5", title: "Personal Data Classification", desc: "Classify sensitivity of personal data before LLM processing.", priority: "high", frameworks: ["GDPR", "OWASP LLM02"],
          steps: ["Create data classification policy (public, private, sensitive)", "Tag files/folders with classification level", "Configure LLM to refuse processing 'sensitive' tagged data", "Implement different retention policies per classification", "Review classification monthly"],
          verify: ["Classification tags present on data", "Sensitive data blocked from LLM", "Retention policies active", "Monthly review scheduled"] },
        { id: "usr-6", title: "Credential Leak Prevention", desc: "Prevent accidental exposure of credentials in LLM prompts.", priority: "critical", frameworks: ["OWASP LLM02", "CWE-798"],
          steps: ["Scan prompts for credential patterns before sending", "Use environment variables, never paste secrets", "Implement .llmignore for sensitive files", "Auto-redact API keys, passwords, tokens in input", "Alert on credential-like patterns in output"],
          verify: ["Test prompt with fake API key - gets redacted", ".llmignore excludes .env, credentials files", "Output scanning catches leaked secrets", "Alerts fire on credential patterns"] },
        { id: "usr-7", title: "Local Backup Before LLM Modifications", desc: "Always backup before letting LLM modify files.", priority: "high", frameworks: ["Best Practice"],
          steps: ["Implement automatic backup before any file modification", "Use git for version control on LLM-managed files", "Configure backup retention (keep last 10 versions)", "Test restore procedure monthly", "Store backups on separate volume"],
          verify: ["Backup created before each modification", "Git history shows all changes", "Can restore to any previous version", "Backups on separate storage confirmed"] },
        { id: "usr-8", title: "Output Validation for Automated Actions", desc: "Validate LLM outputs before executing any automated action.", priority: "critical", frameworks: ["OWASP LLM06"],
          steps: ["Parse and validate LLM output format before execution", "Implement allowlist of permitted operations", "Require human confirmation for irreversible actions", "Rate limit automated executions", "Log all LLM-triggered actions with full context"],
          verify: ["Malformed output rejected", "Only allowlisted operations execute", "Destructive actions need confirmation", "Rate limits prevent runaway automation"] }
      ]
    },
    {
      id: "agentic-security", title: "3. Agentic/Orchestration Security", short: "Agentic Security",
      icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>`,
      desc: "Security for multi-agent systems, orchestrators, Claude Code, MCP servers, and human-in-the-loop workflows.",
      items: [
        { id: "agt-1", title: "Master Orchestrator Isolation", desc: "Isolate orchestrator agent from worker agents with strict boundaries.", priority: "critical", frameworks: ["ATLAS AML.T0041", "Zero Trust"],
          steps: ["Run orchestrator in separate container/process from workers", "Implement message queue for orchestrator-worker communication", "Orchestrator should not have direct file/network access workers have", "Use separate credentials for orchestrator vs workers", "Log all orchestrator decisions and delegations"],
          verify: ["Orchestrator process isolated (different PID namespace)", "Communication only via message queue", "Orchestrator can't access worker resources directly", "Credential separation verified"] },
        { id: "agt-2", title: "Worker Agent Sandboxing", desc: "Each worker agent runs in isolated sandbox with minimal permissions.", priority: "critical", frameworks: ["ATLAS AML.T0041", "Principle of Least Privilege"],
          steps: ["Run each worker in separate container with --cap-drop=ALL", "Mount only required directories as read-only where possible", "Network isolation: workers can't communicate directly with each other", "Set resource limits per worker (CPU, memory, time)", "Implement worker termination on timeout or error"],
          verify: ["Workers in separate containers", "File access limited to required paths", "Workers can't reach other workers", "Resource limits enforced", "Timeout kills runaway workers"] },
        { id: "agt-3", title: "Human-in-the-Loop via PR/MR", desc: "Require human approval via Pull/Merge Request for agent changes.", priority: "critical", frameworks: ["SDLC Security", "Change Management"],
          steps: ["Configure agents to create branches, never push to main", "All changes submitted as Pull/Merge Request", "Require human review and approval before merge", "Implement automated checks (linting, tests) on PR", "Audit log of all approvals with approver identity"],
          verify: ["Direct push to main blocked", "PRs require approval", "CI checks run on all PRs", "Approval audit trail exists"] },
        { id: "agt-4", title: "MCP Server Authentication", desc: "Secure MCP (Model Context Protocol) servers with proper authentication.", priority: "critical", frameworks: ["OWASP API Security"],
          steps: ["Implement API key or mTLS authentication for MCP connections", "Validate client identity before accepting connections", "Use allowlist of permitted MCP clients", "Encrypt all MCP traffic (TLS 1.3)", "Log all MCP connections with client identity"],
          verify: ["Unauthenticated MCP connection rejected", "Client identity logged", "TLS enforced on all connections", "Only allowlisted clients connect"] },
        { id: "agt-5", title: "Shared Memory/State Security", desc: "Secure persistent storage used for agent shared memory.", priority: "high", frameworks: ["OWASP LLM02", "Data Protection"],
          steps: ["Encrypt shared memory/state storage at rest", "Implement access control: which agents can read/write what", "Version all state changes with agent identity", "Set retention policy for shared state", "Implement state validation before agent reads"],
          verify: ["Storage encryption verified", "Agent A can't access Agent B's private state", "State changes tracked with agent ID", "Old state automatically purged"] },
        { id: "agt-6", title: "Context Window Management", desc: "Prevent context poisoning and manage context limits securely.", priority: "high", frameworks: ["OWASP LLM01", "ATLAS AML.T0051"],
          steps: ["Implement context size monitoring and limits", "Sanitize context before passing between agents", "Clear sensitive data from context after use", "Detect and block context injection attempts", "Log context size and content hashes"],
          verify: ["Context size alerts at threshold", "Cross-agent context is sanitized", "Sensitive data cleared after task", "Injection patterns blocked"] },
        { id: "agt-7", title: "GitHub/GitLab MCP Security", desc: "Secure integration with GitHub/GitLab via MCP servers.", priority: "critical", frameworks: ["GitHub Security", "GitLab Security"],
          steps: ["Use fine-grained tokens with minimal permissions", "Token should only have access to specific repos", "Implement branch protection rules", "Require signed commits for agent-created commits", "Monitor for unusual commit patterns"],
          verify: ["Token has minimal scopes", "Token limited to required repos", "Branch protection active", "Commits are signed", "Alerting on anomalous activity"] },
        { id: "agt-8", title: "Parallel Agent Coordination", desc: "Secure coordination when running multiple agents in parallel.", priority: "high", frameworks: ["Distributed Systems Security"],
          steps: ["Implement distributed locking for shared resources", "Prevent race conditions in file/state access", "Set maximum parallel agent count", "Monitor for deadlocks and implement timeouts", "Log all coordination events"],
          verify: ["Locks prevent concurrent modification", "No race conditions in testing", "Parallel limit enforced", "Deadlock detection working"] },
        { id: "agt-9", title: "Agent Task Scoping", desc: "Strictly scope what each agent task can do.", priority: "critical", frameworks: ["Principle of Least Privilege"],
          steps: ["Define explicit task boundaries in agent instructions", "Implement capability-based security per task", "Agent can't request capabilities beyond task scope", "Log capability usage per task", "Alert on scope violation attempts"],
          verify: ["Task boundaries documented", "Capabilities limited to task needs", "Scope escalation blocked", "All capability use logged"] },
        { id: "agt-10", title: "Agent Output Validation Pipeline", desc: "Validate all agent outputs before action or display.", priority: "critical", frameworks: ["OWASP LLM05", "Input Validation"],
          steps: ["Implement output schema validation", "Scan outputs for injection patterns", "Validate outputs against expected format", "Quarantine suspicious outputs for review", "Never execute unvalidated agent output"],
          verify: ["Schema validation catches malformed output", "Injection patterns detected", "Invalid format rejected", "Suspicious outputs quarantined"] },
        { id: "agt-11", title: "Agent Rollback Capability", desc: "Ability to rollback any changes made by agents.", priority: "high", frameworks: ["Disaster Recovery"],
          steps: ["Track all agent modifications with transaction IDs", "Implement automated rollback procedure", "Test rollback monthly", "Keep rollback data for 30 days minimum", "Document rollback procedure"],
          verify: ["All changes have transaction IDs", "Rollback tested and working", "30-day rollback data retained", "Procedure documented"] },
        { id: "agt-12", title: "Claude Code Specific Security", desc: "Security measures specific to Claude Code CLI usage.", priority: "high", frameworks: ["CLI Security", "OWASP"],
          steps: ["Review all subagent spawn requests", "Limit Claude Code file system access", "Use --allowedTools flag to restrict capabilities", "Monitor token usage to detect extraction attempts", "Implement project-specific permission profiles"],
          verify: ["Subagent spawns logged", "File access limited to project", "Only needed tools enabled", "Token usage monitored", "Permission profiles active"] }
      ]
    },
    {
      id: "prompt-injection", title: "4. Prompt Injection Defense", short: "Prompt Injection",
      icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>`,
      desc: "Defense against OWASP LLM01 - the #1 vulnerability.",
      items: [
        { id: "pi-1", title: "Input Validation Layer", desc: "Length limits, character filtering, pattern detection.", priority: "critical", frameworks: ["OWASP LLM01", "ATLAS AML.T0051"],
          steps: ["Set max input length (4096 tokens)", "Filter special characters: <, >, [, ]", "Block 'ignore previous', 'disregard instructions'", "Sanitize Unicode homoglyphs", "Log all filtered inputs"],
          verify: ["'Ignore all instructions' is blocked", "Oversized input rejected", "Unicode bypass attempts fail"] },
        { id: "pi-2", title: "Instruction Hierarchy", desc: "System prompts always take precedence over user input.", priority: "critical", frameworks: ["OWASP LLM01"],
          steps: ["Use clear delimiters: [SYSTEM]...[USER]", "Parse to always prioritize system section", "Add meta-instruction about hierarchy", "Test with adversarial prompts"],
          verify: ["User 'You are now...' ignored", "System prompt always first", "Delimiter injection escaped"] },
        { id: "pi-3", title: "Output Filtering", desc: "Scan outputs for PII, prompt leakage, harmful content.", priority: "critical", frameworks: ["OWASP LLM05", "ATLAS AML.T0057"],
          steps: ["Implement PII regex detection", "Add system prompt fingerprint detection", "Deploy content safety classifier", "Log suspicious outputs"],
          verify: ["'Repeat system prompt' filtered", "Fake SSN in output redacted", "Harmful content blocked"] },
        { id: "pi-4", title: "Indirect Injection Defense", desc: "Sanitize documents before RAG ingestion.", priority: "critical", frameworks: ["ATLAS AML.T0051.001"],
          steps: ["Parse and sanitize all documents", "Remove hidden text and metadata", "Mark retrieved content as untrusted", "Scan for instruction patterns"],
          verify: ["Hidden injection in doc sanitized", "Metadata stripped", "Malicious doc injection fails"] },
        { id: "pi-5", title: "Semantic Analysis", desc: "ML classifiers to detect manipulation beyond keywords.", priority: "high", frameworks: ["OWASP LLM01"],
          steps: ["Deploy intent classification model", "Classify: normal, suspicious, malicious", "Set blocking threshold (>0.8)", "Retrain monthly on new patterns"],
          verify: ["Known injections classified malicious", "Normal prompts pass", "False positive rate <5%"] },
        { id: "pi-6", title: "Injection Monitoring", desc: "Real-time alerting on suspected injection attempts.", priority: "high", frameworks: ["MITRE ATLAS"],
          steps: ["Log all blocked/suspicious inputs", "Configure real-time alerts", "Create trend dashboard", "Weekly pattern review"],
          verify: ["Test injection triggers alert", "Logs contain context", "Dashboard reflects attempts"] }
      ]
    },
    {
      id: "supply-chain", title: "5. Supply Chain Security", short: "Supply Chain",
      icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>`,
      desc: "OWASP LLM03 & ATLAS AML.T0010 - $1B+ documented impact.",
      items: [
        { id: "sc-1", title: "Model Provenance", desc: "Verify source and integrity of all models.", priority: "critical", frameworks: ["OWASP LLM03", "ATLAS AML.T0010"],
          steps: ["Establish approved source list", "Document provenance for each model", "Verify publisher identity", "Review model cards"],
          verify: ["All models have documented source", "No models from unknown sources", "Model cards reviewed"] },
        { id: "sc-2", title: "Integrity Hashing", desc: "SHA-256 verification before every load.", priority: "critical", frameworks: ["ATLAS AML.T0031"],
          steps: ["Calculate SHA-256 for all model files", "Store hashes separately", "Verify before every load", "Alert on mismatch"],
          verify: ["Modified file fails to load", "Verification in code path", "Alerts working"] },
        { id: "sc-3", title: "Dependency Scanning", desc: "Scan PyTorch, transformers, LangChain for CVEs.", priority: "critical", frameworks: ["OWASP LLM03"],
          steps: ["Run pip-audit weekly", "Integrate in CI/CD", "Patch critical CVEs in 72h", "Document exceptions"],
          verify: ["pip-audit shows no critical CVEs", "CI fails on vulnerabilities", "Recent patches applied"] },
        { id: "sc-4", title: "SBOM Maintenance", desc: "Software Bill of Materials for all AI components.", priority: "high", frameworks: ["OWASP LLM03", "NIST"],
          steps: ["Generate SBOM with syft/cyclonedx", "Include models and frameworks", "Store in version control", "Update on changes"],
          verify: ["SBOM exists and current", "Matches installed packages", "In version control"] },
        { id: "sc-5", title: "Safe Serialization", desc: "Use safetensors, not pickle.", priority: "high", frameworks: ["ATLAS AML.T0010"],
          steps: ["Convert pickle to safetensors", "Reject pickle by default", "Sandbox any pickle loading", "Scan with fickling"],
          verify: ["Production uses safetensors", "Pickle load rejected", "Sandbox isolation verified"] },
        { id: "sc-6", title: "Model Assessment", desc: "Security review before any third-party model.", priority: "high", frameworks: ["OWASP LLM03"],
          steps: ["Create assessment checklist", "Test in isolated environment", "Check for backdoors", "Require security sign-off"],
          verify: ["Assessment records exist", "Isolated testing done", "Sign-off documented"] }
      ]
    },
    {
      id: "data-protection", title: "6. Data Protection", short: "Data Protection",
      icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"/></svg>`,
      desc: "OWASP LLM02 Sensitive Information Disclosure.",
      items: [
        { id: "dp-1", title: "Output Scanning", desc: "Scan all outputs for PII, credentials, keys.", priority: "critical", frameworks: ["OWASP LLM02", "ATLAS AML.T0057"],
          steps: ["Implement PII regex patterns", "Add credential detection", "Configure redaction actions", "Log detections"],
          verify: ["Test SSN is redacted", "API key detected", "False positive rate acceptable"] },
        { id: "dp-2", title: "Input Sanitization", desc: "Remove PII from prompts before processing.", priority: "critical", frameworks: ["OWASP LLM02"],
          steps: ["Detect PII in inputs", "Replace with placeholders", "Store mapping for restoration", "Log sanitization"],
          verify: ["Email in input sanitized", "Logs show sanitization", "Restoration works"] },
        { id: "dp-3", title: "RAG Access Controls", desc: "Document-level permissions in retrieval.", priority: "critical", frameworks: ["OWASP LLM08"],
          steps: ["Tag documents with access levels", "Implement user authentication", "Filter results by permissions", "Audit access logs"],
          verify: ["User A can't get User B docs", "Permission filtering works", "Access logged"] },
        { id: "dp-4", title: "Context Isolation", desc: "No context leakage between users/sessions.", priority: "high", frameworks: ["ATLAS AML.T0024"],
          steps: ["Session-based context storage", "Clear on session end", "Never share between users", "Implement context limits"],
          verify: ["New session has no prior context", "Context cleared on logout", "User isolation verified"] },
        { id: "dp-5", title: "Encryption at Rest", desc: "AES-256 for all LLM data.", priority: "critical", frameworks: ["NIST"],
          steps: ["Enable disk encryption", "Application-level for sensitive fields", "Key management via HSM/KMS", "Annual key rotation"],
          verify: ["Encryption status verified", "Keys in secure storage", "Rotation scheduled"] },
        { id: "dp-6", title: "Data Retention", desc: "Auto-delete after retention period.", priority: "high", frameworks: ["GDPR", "OWASP LLM02"],
          steps: ["Define retention periods", "Automate deletion jobs", "Implement user deletion API", "Verify complete deletion"],
          verify: ["Retention policy documented", "Deletion jobs running", "No residual data"] }
      ]
    },
    {
      id: "access-control", title: "7. Access Control", short: "Access Control",
      icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/></svg>`,
      desc: "Authentication and authorization for LLM access.",
      items: [
        { id: "ac-1", title: "MFA Required", desc: "Multi-factor for all access paths.", priority: "critical", frameworks: ["ATLAS AML.T0012"],
          steps: ["Enable MFA on all admin accounts", "Implement for API access", "Hardware tokens for privileged", "Enforce no-exceptions policy"],
          verify: ["Login without MFA fails", "All admins have MFA", "API requires second factor"] },
        { id: "ac-2", title: "RBAC Implementation", desc: "Role-based access with least privilege.", priority: "critical", frameworks: ["NIST"],
          steps: ["Define roles: Admin, Operator, User", "Map users to roles", "Implement permission checks", "Quarterly access reviews"],
          verify: ["User can't access admin functions", "Permission checks in code", "Reviews completed"] },
        { id: "ac-3", title: "API Key Management", desc: "OAuth 2.0, 90-day rotation, rate limiting.", priority: "critical", frameworks: ["OWASP LLM10"],
          steps: ["Implement OAuth 2.0 or API keys", "256-bit entropy keys", "90-day rotation policy", "Per-key rate limiting"],
          verify: ["Auth required for API", "Keys are hashed", "Rotation reminders sent", "Rate limits work"] },
        { id: "ac-4", title: "Session Security", desc: "15-30 min timeout, secure tokens.", priority: "high", frameworks: ["OWASP"],
          steps: ["Configure idle timeout", "Secure, httpOnly, sameSite cookies", "Session revocation API", "Regenerate ID on privilege change"],
          verify: ["Timeout works", "Cookie flags set", "Revocation works"] },
        { id: "ac-5", title: "Privileged Access", desc: "PAM, just-in-time access, session recording.", priority: "high", frameworks: ["NIST"],
          steps: ["Deploy PAM solution", "JIT access with approval", "Record privileged sessions", "Max session duration"],
          verify: ["PAM required for admin", "JIT workflow works", "Recordings captured"] }
      ]
    },
    {
      id: "monitoring", title: "8. Monitoring", short: "Monitoring",
      icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>`,
      desc: "Security monitoring and detection.",
      items: [
        { id: "mon-1", title: "Auth Logging", desc: "All attempts, MFA events, sessions.", priority: "critical", frameworks: ["MITRE ATLAS"],
          steps: ["Log: timestamp, user, IP, method, result", "Include geolocation", "Forward to SIEM", "Alert on suspicious patterns"],
          verify: ["Failed login logged", "Logs in SIEM", "Alerts trigger"] },
        { id: "mon-2", title: "Inference Logging", desc: "Request metadata (not content by default).", priority: "critical", frameworks: ["ATLAS AML.T0024"],
          steps: ["Log: request ID, user, tokens, latency", "Do NOT log prompt content", "Enable searchable logging"],
          verify: ["Metadata logged", "Content NOT logged", "Search works"] },
        { id: "mon-3", title: "Injection Alerts", desc: "Real-time detection and alerting.", priority: "critical", frameworks: ["OWASP LLM01", "ATLAS AML.T0051"],
          steps: ["Implement pattern detection rules", "Configure real-time alerts", "Include context in alerts", "Weekly rule tuning"],
          verify: ["Test injection triggers alert", "Context in alert", "Rules updated"] },
        { id: "mon-4", title: "Extraction Detection", desc: "Detect systematic querying patterns.", priority: "high", frameworks: ["ATLAS AML.T0024"],
          steps: ["Baseline normal query patterns", "Alert on high volume/systematic", "Progressive rate limiting", "Track query diversity"],
          verify: ["Extraction pattern detected", "Rate limiting engages", "Alerts fire"] },
        { id: "mon-5", title: "Log Protection", desc: "Encrypted, tamper-evident, restricted.", priority: "critical", frameworks: ["NIST"],
          steps: ["Encrypt log storage", "Append-only logging", "Restrict access", "Integrity verification"],
          verify: ["Encryption enabled", "Modification fails", "Access restricted"] }
      ]
    },
    {
      id: "incident-response", title: "9. Incident Response", short: "Incident Response",
      icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`,
      desc: "Response procedures for LLM security events.",
      items: [
        { id: "ir-1", title: "LLM IR Plan", desc: "Playbooks for injection, leakage, poisoning.", priority: "critical", frameworks: ["MITRE ATLAS", "NIST"],
          steps: ["Create playbooks per attack type", "Define severity levels", "Document escalation paths", "Include regulatory requirements"],
          verify: ["Playbooks exist", "Accessible to IR team", "Contacts current"] },
        { id: "ir-2", title: "Rapid Containment", desc: "Shutdown, isolation, evidence preservation.", priority: "critical", frameworks: ["NIST"],
          steps: ["Document emergency shutdown", "Create isolation runbook", "Prepare notification templates", "Test procedures regularly"],
          verify: ["Shutdown works", "Isolation tested", "Templates ready"] },
        { id: "ir-3", title: "AI Forensics", desc: "Capture model state, logs, embeddings.", priority: "high", frameworks: ["MITRE ATLAS"],
          steps: ["Document evidence locations", "Prepare collection tools", "Train IR team on AI", "Create chain of custody"],
          verify: ["Tools available", "Collection tested", "Team trained"] },
        { id: "ir-4", title: "Model Rollback", desc: "Restore previous version in <1 hour.", priority: "high", frameworks: ["ATLAS AML.T0031"],
          steps: ["Maintain versioned backups", "Document rollback procedure", "Test quarterly", "Verify backup integrity"],
          verify: ["Rollback tested", "Backups valid", "<1 hour RTO met"] },
        { id: "ir-5", title: "Tabletop Exercises", desc: "Quarterly exercises with AI/ML experts.", priority: "high", frameworks: ["MITRE ATLAS"],
          steps: ["Schedule quarterly", "Create realistic scenarios", "Include cross-functional teams", "Document findings"],
          verify: ["Exercises scheduled", "Findings documented", "Gaps remediated"] }
      ]
    }
  ]
};

// STATE
let state = {};

function loadState() {
  const s = localStorage.getItem(STATE_KEY);
  if (s) try { state = JSON.parse(s); } catch(e) { state = {}; }
  data.sections.forEach(sec => sec.items.forEach(item => {
    if (!state[item.id]) state[item.id] = { done: false, comment: '' };
  }));
}

function saveState() {
  localStorage.setItem(STATE_KEY, JSON.stringify(state));
  updateProgress();
}

// RENDER
function renderTOC() {
  const html = data.sections.map(s => `
    <button onclick="scrollTo('${s.id}')" class="toc-item w-full text-left px-3 py-2 rounded-lg text-sm flex items-center gap-2 dark:text-cyber-100 text-slate-700 dark:hover:bg-cyber-700 hover:bg-slate-100" data-section="${s.id}">
      ${s.icon}<span class="truncate">${s.short}</span>
    </button>
  `).join('');
  document.getElementById('desktop-toc').innerHTML = html;
  document.getElementById('mobile-toc').innerHTML = html;
}

function renderSections() {
  document.getElementById('main-content').innerHTML = data.sections.map(sec => `
    <section id="section-${sec.id}" class="mb-10">
      <div class="flex items-start gap-3 mb-4">
        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-accent-cyan/20 to-accent-green/20 border border-accent-cyan/30 flex items-center justify-center text-accent-cyan">${sec.icon}</div>
        <div>
          <h2 class="font-display font-bold text-lg dark:text-white text-slate-900">${sec.title}</h2>
          <p class="text-xs dark:text-cyber-200 text-slate-500">${sec.desc}</p>
        </div>
      </div>
      <div class="space-y-2">${sec.items.map(item => renderItem(item)).join('')}</div>
    </section>
  `).join('');
}

function renderItem(item) {
  const s = state[item.id] || { done: false, comment: '' };
  const pc = { critical: 'bg-accent-red/20 text-accent-red border-accent-red/30', high: 'bg-accent-amber/20 text-accent-amber border-accent-amber/30', medium: 'bg-accent-purple/20 text-accent-purple border-accent-purple/30', low: 'bg-accent-green/20 text-accent-green border-accent-green/30' };
  return `
    <div class="checklist-item checklist-item-clickable ${s.done ? 'completed' : ''} status-${item.priority} rounded-lg p-3 border dark:bg-cyber-800/50 dark:border-cyber-600 bg-white border-slate-200 shadow-sm" data-id="${item.id}" onclick="showDetail('${item.id}')">
      <div class="flex items-start gap-3">
        <input type="checkbox" ${s.done ? 'checked' : ''} onclick="event.stopPropagation()" onchange="toggle('${item.id}')">
        <div class="flex-1 min-w-0">
          <div class="flex flex-wrap items-center gap-2 mb-1">
            <span class="item-title font-display font-semibold text-sm dark:text-white text-slate-900">${item.title}</span>
            <span class="px-2 py-0.5 rounded text-[10px] font-mono uppercase border ${pc[item.priority]}">${item.priority}</span>
            <span class="text-accent-cyan text-xs hidden sm:inline">üìã Click for steps</span>
          </div>
          <p class="text-xs dark:text-cyber-200 text-slate-600">${item.desc}</p>
          ${item.frameworks?.length ? `<div class="flex flex-wrap gap-1 mt-2">${item.frameworks.map(f => `<span class="framework-badge dark:bg-cyber-700 dark:text-cyber-100 bg-slate-100 text-slate-600">${f}</span>`).join('')}</div>` : ''}
          ${s.comment ? `<div class="mt-2 p-2 rounded border text-xs font-mono dark:bg-cyber-900/50 dark:border-cyber-700 dark:text-cyber-100 bg-slate-50 border-slate-200 text-slate-700">üí¨ ${esc(s.comment)}</div>` : ''}
        </div>
        <button onclick="event.stopPropagation(); openComment('${item.id}')" class="p-2 rounded-lg dark:text-cyber-300 dark:hover:bg-cyber-700 text-slate-400 hover:bg-slate-100" title="Comment">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/></svg>
        </button>
      </div>
    </div>
  `;
}

// DETAIL MODAL
function showDetail(id) {
  let item = null;
  for (const sec of data.sections) { item = sec.items.find(i => i.id === id); if (item) break; }
  if (!item) return;
  const s = state[id] || { done: false, comment: '' };
  const pc = { critical: 'bg-accent-red/20 text-accent-red border-accent-red/30', high: 'bg-accent-amber/20 text-accent-amber border-accent-amber/30', medium: 'bg-accent-purple/20 text-accent-purple border-accent-purple/30', low: 'bg-accent-green/20 text-accent-green border-accent-green/30' };
  
  document.getElementById('detail-content').innerHTML = `
    <div class="animate-slide-in">
      <div class="mb-6">
        <div class="flex items-center gap-2 mb-2">
          <span class="px-2 py-1 rounded text-xs font-mono uppercase border ${pc[item.priority]}">${item.priority}</span>
          ${s.done ? '<span class="px-2 py-1 rounded text-xs font-mono bg-accent-green/20 text-accent-green">‚úì Done</span>' : ''}
        </div>
        <h3 class="font-display font-bold text-xl dark:text-white text-slate-900">${item.title}</h3>
        <p class="text-sm mt-2 dark:text-cyber-200 text-slate-600">${item.desc}</p>
        ${item.frameworks?.length ? `<div class="flex flex-wrap gap-1 mt-3">${item.frameworks.map(f => `<span class="framework-badge dark:bg-cyber-700 dark:text-cyber-100 bg-slate-100 text-slate-600">${f}</span>`).join('')}</div>` : ''}
      </div>
      
      <div class="mb-6">
        <h4 class="font-display font-semibold text-sm uppercase tracking-wider mb-3 flex items-center gap-2 dark:text-accent-cyan text-cyan-600">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
          Implementation Steps
        </h4>
        <div class="space-y-2">
          ${item.steps.map((step, i) => `
            <div class="flex gap-3 p-3 rounded-lg border dark:bg-cyber-900/30 dark:border-cyber-700 bg-slate-50 border-slate-200">
              <div class="step-num dark:bg-accent-cyan/20 dark:text-accent-cyan bg-cyan-100 text-cyan-700">${i + 1}</div>
              <p class="text-sm dark:text-cyber-100 text-slate-700">${step}</p>
            </div>
          `).join('')}
        </div>
      </div>
      
      <div class="mb-6">
        <h4 class="font-display font-semibold text-sm uppercase tracking-wider mb-3 flex items-center gap-2 dark:text-accent-green text-green-600">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          How to Verify
        </h4>
        <div class="space-y-2">
          ${item.verify.map(v => `
            <div class="flex gap-2 p-3 rounded-lg border dark:bg-green-900/20 dark:border-green-800/50 bg-green-50 border-green-200">
              <span class="text-accent-green flex-shrink-0">‚úì</span>
              <p class="text-sm dark:text-green-200 text-green-800">${v}</p>
            </div>
          `).join('')}
        </div>
      </div>
      
      <div class="flex gap-3 pt-4 border-t dark:border-cyber-700 border-slate-200">
        <button onclick="toggle('${item.id}'); showDetail('${item.id}')" class="flex-1 py-3 rounded-lg font-mono text-sm ${s.done ? 'bg-accent-amber/20 text-accent-amber border border-accent-amber/30' : 'bg-accent-green/20 text-accent-green border border-accent-green/30'}">
          ${s.done ? '‚Ü© Mark Incomplete' : '‚úì Mark Complete'}
        </button>
        <button onclick="closeDetail(); openComment('${item.id}')" class="px-4 py-3 rounded-lg font-mono text-sm border dark:bg-cyber-700 dark:border-cyber-500 dark:text-cyber-100 bg-slate-100 border-slate-200 text-slate-700">üí¨ Comment</button>
      </div>
      
      ${s.comment ? `
        <div class="mt-4 p-3 rounded-lg border dark:bg-cyber-900/50 dark:border-cyber-700 bg-slate-50 border-slate-200">
          <p class="text-xs uppercase tracking-wider mb-1 dark:text-cyber-300 text-slate-500">Your Notes</p>
          <p class="text-sm font-mono dark:text-cyber-100 text-slate-700">${esc(s.comment)}</p>
        </div>
      ` : ''}
    </div>
  `;
  
  document.getElementById('detail-modal').classList.remove('hidden');
  document.getElementById('detail-modal').classList.add('flex');
}

function closeDetail() {
  document.getElementById('detail-modal').classList.add('hidden');
  document.getElementById('detail-modal').classList.remove('flex');
}

// COMMENT
let commentId = null;
function openComment(id) {
  let item = null;
  for (const sec of data.sections) { item = sec.items.find(i => i.id === id); if (item) break; }
  if (!item) return;
  commentId = id;
  document.getElementById('comment-title').textContent = item.title;
  document.getElementById('comment-input').value = state[id]?.comment || '';
  document.getElementById('comment-modal').classList.remove('hidden');
  document.getElementById('comment-modal').classList.add('flex');
  setTimeout(() => document.getElementById('comment-input').focus(), 100);
}
function closeComment() {
  document.getElementById('comment-modal').classList.add('hidden');
  document.getElementById('comment-modal').classList.remove('flex');
  commentId = null;
}
function saveComment() {
  if (commentId) {
    state[commentId].comment = document.getElementById('comment-input').value;
    saveState();
    renderSections();
    toast('Comment saved', 'success');
  }
  closeComment();
}

// ACTIONS
function toggle(id) {
  state[id].done = !state[id].done;
  saveState();
  renderSections();
}

function toggleSidebar() {
  document.getElementById('mobile-sidebar').classList.toggle('active');
  document.getElementById('sidebar-overlay').classList.toggle('active');
}
function closeSidebar() {
  document.getElementById('mobile-sidebar').classList.remove('active');
  document.getElementById('sidebar-overlay').classList.remove('active');
}

function scrollTo(id) {
  closeSidebar();
  const el = document.getElementById(`section-${id}`);
  if (el) {
    el.scrollIntoView({ behavior: 'smooth', block: 'start' });
    document.querySelectorAll('.toc-item').forEach(t => t.classList.toggle('active', t.dataset.section === id));
  }
}

// PROGRESS
function updateProgress() {
  let total = 0, done = 0;
  data.sections.forEach(sec => sec.items.forEach(item => { total++; if (state[item.id]?.done) done++; }));
  const pct = total ? Math.round((done / total) * 100) : 0;
  document.getElementById('progress-percent').textContent = `${pct}%`;
  document.getElementById('mobile-progress').textContent = `${pct}%`;
  document.getElementById('progress-circle').setAttribute('stroke-dasharray', `${pct}, 100`);
  
  const stats = { critical: { t: 0, d: 0 }, high: { t: 0, d: 0 }, medium: { t: 0, d: 0 }, low: { t: 0, d: 0 } };
  data.sections.forEach(sec => sec.items.forEach(item => {
    if (stats[item.priority]) { stats[item.priority].t++; if (state[item.id]?.done) stats[item.priority].d++; }
  }));
  ['critical', 'high', 'medium', 'low'].forEach(p => {
    const el = document.getElementById(`stat-${p}`);
    if (el) el.textContent = `${stats[p].d}/${stats[p].t}`;
  });
}

// EXPORT JSON
function exportJSON() {
  const obj = { version: '5.0', date: new Date().toISOString(), state };
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([JSON.stringify(obj, null, 2)], { type: 'application/json' }));
  a.download = `llm-security-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  toast('JSON exported', 'success');
}

// EXPORT MARKDOWN REPORT
function exportMarkdown() {
  const now = new Date();
  let total = 0, done = 0;
  data.sections.forEach(sec => sec.items.forEach(item => { total++; if (state[item.id]?.done) done++; }));
  const pct = total ? Math.round((done / total) * 100) : 0;
  
  let md = `# LLM Security Assessment Report

**Generated:** ${now.toLocaleDateString()} ${now.toLocaleTimeString()}  
**Framework:** MITRE ATLAS + OWASP LLM Top 10 (2025)

---

## Executive Summary

| Metric | Value |
|--------|-------|
| **Overall Progress** | ${pct}% (${done}/${total} items) |
| **Assessment Date** | ${now.toLocaleDateString()} |

### Progress by Priority

`;

  const stats = { critical: { t: 0, d: 0 }, high: { t: 0, d: 0 }, medium: { t: 0, d: 0 }, low: { t: 0, d: 0 } };
  data.sections.forEach(sec => sec.items.forEach(item => {
    if (stats[item.priority]) { stats[item.priority].t++; if (state[item.id]?.done) stats[item.priority].d++; }
  }));
  
  md += `| Priority | Completed | Total | Status |
|----------|-----------|-------|--------|
| üî¥ Critical | ${stats.critical.d} | ${stats.critical.t} | ${stats.critical.d === stats.critical.t ? '‚úÖ Complete' : '‚ö†Ô∏è Incomplete'} |
| üü† High | ${stats.high.d} | ${stats.high.t} | ${stats.high.d === stats.high.t ? '‚úÖ Complete' : '‚ö†Ô∏è Incomplete'} |
| üü£ Medium | ${stats.medium.d} | ${stats.medium.t} | ${stats.medium.d === stats.medium.t ? '‚úÖ Complete' : '‚ö†Ô∏è Incomplete'} |
| üü¢ Low | ${stats.low.d} | ${stats.low.t} | ${stats.low.d === stats.low.t ? '‚úÖ Complete' : '‚ö†Ô∏è Incomplete'} |

---

## Detailed Assessment

`;

  data.sections.forEach(sec => {
    const secDone = sec.items.filter(i => state[i.id]?.done).length;
    const secTotal = sec.items.length;
    
    md += `### ${sec.title}

**Progress:** ${secDone}/${secTotal} (${secTotal ? Math.round((secDone/secTotal)*100) : 0}%)  
**Description:** ${sec.desc}

| Status | Item | Priority | Frameworks | Notes |
|--------|------|----------|------------|-------|
`;

    sec.items.forEach(item => {
      const s = state[item.id] || { done: false, comment: '' };
      const status = s.done ? '‚úÖ' : '‚¨ú';
      const priority = { critical: 'üî¥ Critical', high: 'üü† High', medium: 'üü£ Medium', low: 'üü¢ Low' }[item.priority] || item.priority;
      const frameworks = item.frameworks?.join(', ') || '-';
      const notes = s.comment ? s.comment.replace(/\|/g, '\\|').replace(/\n/g, ' ') : '-';
      
      md += `| ${status} | ${item.title} | ${priority} | ${frameworks} | ${notes} |\n`;
    });
    
    md += '\n';
    
    const incomplete = sec.items.filter(i => !state[i.id]?.done);
    if (incomplete.length > 0) {
      md += `#### Outstanding Items\n\n`;
      incomplete.forEach(item => {
        md += `**${item.title}** (${item.priority.toUpperCase()})\n\n`;
        md += `${item.desc}\n\n`;
        md += `*Implementation Steps:*\n`;
        item.steps.forEach((step, i) => md += `${i + 1}. ${step}\n`);
        md += `\n*Verification:*\n`;
        item.verify.forEach(v => md += `- ${v}\n`);
        md += '\n---\n\n';
      });
    }
  });

  md += `## Appendix: Framework References

### MITRE ATLAS
- **AML.T0035**: ML Artifact Collection
- **AML.T0041**: Physical Environment Access
- **AML.T0010**: ML Supply Chain Compromise
- **AML.T0051**: LLM Prompt Injection
- **AML.T0057**: LLM Data Leakage
- **AML.T0024**: Exfiltration via ML Inference API

### OWASP LLM Top 10 (2025)
- **LLM01**: Prompt Injection
- **LLM02**: Sensitive Information Disclosure
- **LLM03**: Supply Chain Vulnerabilities
- **LLM05**: Improper Output Handling
- **LLM06**: Excessive Agency
- **LLM07**: System Prompt Leakage
- **LLM08**: Vector and Embedding Weaknesses
- **LLM10**: Unbounded Consumption

---

*Report generated by LLM Security Checklist Tool*  
*Based on MITRE ATLAS and OWASP LLM Top 10 frameworks*
`;

  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([md], { type: 'text/markdown' }));
  a.download = `llm-security-report-${now.toISOString().split('T')[0]}.md`;
  a.click();
  toast('Report exported', 'success');
}

// IMPORT
function importJSON(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (ev) => {
    try {
      const d = JSON.parse(ev.target.result);
      if (d.state) {
        Object.keys(d.state).forEach(k => { if (state[k] !== undefined) state[k] = d.state[k]; });
        saveState();
        renderSections();
        toast('Imported successfully', 'success');
      }
    } catch { toast('Import failed', 'error'); }
  };
  reader.readAsText(file);
  e.target.value = '';
}

function resetAll() {
  if (confirm('Reset all progress? This cannot be undone.')) {
    localStorage.removeItem(STATE_KEY);
    state = {};
    loadState();
    renderSections();
    toast('Reset complete', 'info');
  }
}

// UTILS
function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

function toast(msg, type = 'info') {
  const c = document.getElementById('toast');
  const colors = { success: 'bg-accent-green/20 border-accent-green text-accent-green', error: 'bg-accent-red/20 border-accent-red text-accent-red', info: 'bg-accent-cyan/20 border-accent-cyan text-accent-cyan' };
  const t = document.createElement('div');
  t.className = `px-4 py-3 rounded-lg border ${colors[type]} font-mono text-sm animate-slide-up`;
  t.textContent = msg;
  c.appendChild(t);
  setTimeout(() => { t.style.opacity = '0'; setTimeout(() => t.remove(), 300); }, 3000);
}

document.addEventListener('keydown', e => { if (e.key === 'Escape') { closeDetail(); closeComment(); closeSidebar(); } });

// INIT
document.addEventListener('DOMContentLoaded', () => {
  loadState();
  renderTOC();
  renderSections();
  updateProgress();
});
</script>
</body>
</html>